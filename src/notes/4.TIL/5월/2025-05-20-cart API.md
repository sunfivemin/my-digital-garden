---
tags:
  - TIL
created: 2025-05-20
---

# 📘 2025-05-20 TIL

## 📌 오늘 배운 핵심 요약
- 장바구니 테이블을 생성하고, 외래 키(FK) 설정 시 발생한 오류를 해결했다.
- FK 제약조건 이름, 인덱스 이름 중복 문제를 직접 해결해보며 DB 설계의 중요성을 체감했다.
- 장바구니에 상품을 담는 POST API를 구현했다.


## 🧠 상세 학습 내용

## 📍 주제 1: 외래 키(Foreign Key) 이름 충돌 오류 해결

#### ✅ 오류 현상

MySQL Workbench에서 다음과 같은 오류가 발생했다:
```text
ERROR 1005: Can't create table 'Bookshop.cartItems'
(errno: 121 "Duplicate key on write or update")
```
- 이는 **동일한 이름의 제약조건(CONSTRAINT)** 또는 **인덱스 이름이 중복**될 때 발생하는 오류다.
- 특히 자동 생성된 인덱스 이름(book_id_idx, user_id_idx)이 여러 테이블에서 충돌하기 쉬움.

---

#### ✅ 해결 방법 1: 제약조건 이름 직접 지정

제약조건(CONSTRAINT) 이름을 직접 명시적으로 지정하면 된다.

💡 추천 네이밍 규칙
```text
fk_기준테이블명_참조테이블명_컬럼명
```
예시:
- fk_cartItems_books_book_id
- fk_cartItems_users_user_id

이렇게 명확한 이름을 지정하면 추후 관리 및 디버깅도 쉬워진다.

![FK이름](https://seonohblog.netlify.app/assets/FK이름.png)

---

#### ✅ 해결 방법 2: 인덱스 이름 수정

제약조건을 설정하면 MySQL이 자동으로 인덱스도 생성하는데, 이름이 중복되면 충돌이 발생함. 
(Duplicate key name 'book_id_idx')
Workbench에서 인덱스 탭으로 이동해 수동으로 이름을 수정하면 문제 해결.

📌 내 경우, 기본 인덱스 이름이 book_id_idx, user_id_idx였는데 이를 각각 cartItems_book_id_idx, cartItems_user_id_idx로 변경했다.

![인덱스이름](https://seonohblog.netlify.app/assets/인덱스이름.png)

---

## 📍 주제 2: 장바구니 테이블 구조
```sql
CREATE TABLE cartItems (
  id INT PRIMARY KEY AUTO_INCREMENT,
  book_id INT,
  user_id INT,
  quantity INT DEFAULT 1,
  CONSTRAINT fk_cartItems_books_book_id FOREIGN KEY (book_id) REFERENCES books(id),
  CONSTRAINT fk_cartItems_users_user_id FOREIGN KEY (user_id) REFERENCES users(id)
);
```

|**컬럼명**|**설명**|
|---|---|
|id|기본키|
|book_id|도서 ID (외래키)|
|user_id|사용자 ID (외래키)|
|quantity|장바구니에 담은 수량|

![테이블스키마](https://seonohblog.netlify.app/assets/테이블스키마.png)

---

## 📍 주제 3: 장바구니 담기 API 구현 (POST)






## **💭 회고**

### • 새롭게 알게 된 점
- 

### • 어렵게 느껴졌던 부분
- 
### • 다음에 학습할 주제
- 


## 🔗 참고 자료
